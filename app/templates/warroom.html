<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MindRobo War Room ‚Äî Phase 2 Sprint</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
    background: #0a0e1a;
    color: #e2e8f0;
    padding: 20px;
    min-height: 100vh;
  }
  .container { max-width: 1600px; margin: 0 auto; }

  /* Header */
  .header { text-align: center; margin-bottom: 28px; }
  .title {
    font-size: 2.4rem; font-weight: 800;
    background: linear-gradient(135deg, #38bdf8, #6366f1, #ec4899);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; letter-spacing: -0.02em;
  }
  .subtitle { font-size: 1rem; color: #64748b; margin-top: 6px; }

  /* System Status Bar */
  .system-bar {
    background: linear-gradient(135deg, #1e293b, #0f172a);
    border: 1px solid #334155; border-radius: 14px;
    padding: 18px 28px; margin-bottom: 24px;
    display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;
  }
  .sys-item { display: flex; align-items: center; gap: 10px; }
  .sys-item .icon { font-size: 1.8rem; }
  .sys-item h4 { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }
  .sys-item p { font-size: 1.2rem; font-weight: 700; }
  .refresh-info { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: #64748b; }
  .pulse { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.2)} }

  /* Progress Bar */
  .progress-wrap { margin-bottom: 24px; }
  .progress-label { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85rem; color: #94a3b8; }
  .progress-bar { height: 12px; background: #1e293b; border-radius: 6px; overflow: hidden; border: 1px solid #334155; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #06b6d4); border-radius: 6px; transition: width 0.6s ease; }

  /* Two-column layout */
  .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
  @media (max-width: 1100px) { .main-grid { grid-template-columns: 1fr; } }

  /* Section */
  .section {
    background: linear-gradient(135deg, #1e293b, #0f172a);
    border: 1px solid #334155; border-radius: 14px; padding: 20px;
  }
  .section-title { font-size: 1rem; font-weight: 700; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }

  /* Agent Cards */
  .agent-cards { display: flex; flex-direction: column; gap: 12px; }
  .agent-card {
    background: rgba(15,23,42,0.6); border: 1px solid #334155; border-radius: 12px;
    padding: 14px 16px; border-left: 4px solid var(--c);
    transition: all 0.2s;
  }
  .agent-card:hover { border-color: var(--c); background: rgba(15,23,42,0.9); }
  .agent-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
  .agent-name { font-weight: 700; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
  .agent-avatar {
    width: 28px; height: 28px; border-radius: 50%; background: var(--c);
    display: flex; align-items: center; justify-content: center;
    font-size: 0.8rem; font-weight: 700; color: #0a0e1a;
  }
  .model-tag { font-size: 0.65rem; background: rgba(99,102,241,0.2); color: #a5b4fc; padding: 2px 8px; border-radius: 8px; }
  .badge {
    padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.04em;
  }
  .badge.active { background: rgba(34,197,94,0.2); color: #22c55e; }
  .badge.reviewing { background: rgba(251,191,36,0.2); color: #fbbf24; }
  .badge.idle { background: rgba(100,116,139,0.2); color: #94a3b8; }
  .agent-task { font-size: 0.82rem; color: #cbd5e1; font-family: 'Courier New', monospace; margin-bottom: 4px; }
  .agent-branch { font-size: 0.72rem; color: #64748b; }
  .agent-branch code { background: rgba(56,189,248,0.1); color: #38bdf8; padding: 1px 6px; border-radius: 4px; }

  /* Pipeline */
  .pipeline { display: flex; flex-direction: column; gap: 8px; }
  .pipe-item {
    display: flex; align-items: center; gap: 12px;
    padding: 10px 14px; background: rgba(15,23,42,0.6);
    border: 1px solid #334155; border-radius: 10px;
    font-size: 0.85rem;
  }
  .pipe-icon { font-size: 1.2rem; flex-shrink: 0; }
  .pipe-title { flex: 1; color: #cbd5e1; }
  .pipe-issue { color: #64748b; font-size: 0.75rem; }
  .pipe-wave {
    font-size: 0.65rem; padding: 2px 8px; border-radius: 8px;
    background: rgba(99,102,241,0.15); color: #a5b4fc;
  }
  .pipe-status { font-size: 0.7rem; font-weight: 700; padding: 3px 10px; border-radius: 10px; }
  .pipe-status.done { background: rgba(34,197,94,0.15); color: #22c55e; }
  .pipe-status.in_review { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .pipe-status.in_progress { background: rgba(56,189,248,0.15); color: #38bdf8; }
  .pipe-status.pending { background: rgba(100,116,139,0.15); color: #94a3b8; }

  /* PR List */
  .pr-list { display: flex; flex-direction: column; gap: 8px; }
  .pr-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px; background: rgba(15,23,42,0.6);
    border: 1px solid #334155; border-radius: 10px; font-size: 0.82rem;
  }
  .pr-num { color: #38bdf8; font-weight: 700; min-width: 50px; }
  .pr-title { flex: 1; color: #cbd5e1; }
  .pr-branch { font-size: 0.7rem; color: #64748b; }
  .pr-branch code { background: rgba(56,189,248,0.1); color: #38bdf8; padding: 1px 6px; border-radius: 4px; }

  /* Blockers */
  .blocker-box {
    background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
    border-radius: 10px; padding: 14px; margin-bottom: 24px; display: none;
  }
  .blocker-box.visible { display: block; }
  .blocker-title { color: #ef4444; font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; }
  .blocker-item { color: #fca5a5; font-size: 0.85rem; padding: 4px 0; }

  /* Footer */
  .footer { text-align: center; padding: 20px 0; color: #475569; font-size: 0.8rem; }

  /* Mobile */
  @media (max-width: 768px) {
    .title { font-size: 1.6rem; }
    body { padding: 12px; }
    .system-bar { flex-direction: column; align-items: flex-start; }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1 class="title">üöÄ MindRobo War Room</h1>
    <p class="subtitle">Phase 2 Sprint ‚Äî Real-time Status</p>
  </div>

  <!-- System Bar -->
  <div class="system-bar">
    <div class="sys-item">
      <div class="icon">‚ö°</div>
      <div><h4>System</h4><p id="sys-status">‚Äî</p></div>
    </div>
    <div class="sys-item">
      <div class="icon">ü§ñ</div>
      <div><h4>Active Agents</h4><p id="active-count">‚Äî</p></div>
    </div>
    <div class="sys-item">
      <div class="icon">üìä</div>
      <div><h4>Sprint Progress</h4><p id="sprint-progress">‚Äî</p></div>
    </div>
    <div class="refresh-info">
      <span class="pulse"></span>
      <span id="refresh-text">Auto-refresh in 15s</span>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="progress-wrap">
    <div class="progress-label">
      <span>Phase 2 Completion</span>
      <span id="progress-pct">0%</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill" style="width:0%"></div>
    </div>
  </div>

  <!-- Blockers -->
  <div class="blocker-box" id="blocker-box">
    <div class="blocker-title">üö® BLOCKERS</div>
    <div id="blocker-list"></div>
  </div>

  <!-- Main Grid -->
  <div class="main-grid">
    <!-- Left: Agents -->
    <div>
      <div class="section">
        <div class="section-title">ü§ñ Agent Status</div>
        <div class="agent-cards" id="agents-container">
          <div style="text-align:center;padding:30px;color:#64748b">Loading...</div>
        </div>
      </div>

      <!-- Open PRs -->
      <div class="section" style="margin-top:24px">
        <div class="section-title">üîÄ Open Pull Requests</div>
        <div class="pr-list" id="prs-container">
          <div style="text-align:center;padding:20px;color:#64748b">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Right: Pipeline -->
    <div>
      <div class="section">
        <div class="section-title">üìã Sprint Pipeline ‚Äî 9 Issues</div>
        <div class="pipeline" id="pipeline-container">
          <div style="text-align:center;padding:30px;color:#64748b">Loading...</div>
        </div>
      </div>

      <!-- Recently Merged -->
      <div class="section" style="margin-top:24px">
        <div class="section-title">‚úÖ Recently Merged</div>
        <div class="pr-list" id="merged-container">
          <div style="text-align:center;padding:20px;color:#64748b">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <p>Last updated: <span id="last-refresh">‚Äî</span> ¬∑ Auto-refreshes every 15 seconds</p>
  </div>
</div>

<script>
const COLORS = {
  orchestrator: '#3b82f6', backend: '#8b5cf6', frontend: '#06b6d4',
  qa: '#22c55e', ingestion: '#f59e0b'
};
const STATUS_ICONS = { done: '‚úÖ', in_review: 'üîç', in_progress: 'üîÑ', pending: '‚è≥' };
const STATUS_LABELS = { done: 'Done', in_review: 'In Review', in_progress: 'In Progress', pending: 'Pending' };

let timer = 15;

function renderAgent(a) {
  const c = COLORS[a.id] || '#64748b';
  return `
    <div class="agent-card" style="--c:${c}">
      <div class="agent-top">
        <div class="agent-name">
          <div class="agent-avatar" style="background:${c}">${a.name[0]}</div>
          ${a.name}
          <span class="model-tag">${a.model || 'Sonnet'}</span>
        </div>
        <span class="badge ${a.status}">${a.status}</span>
      </div>
      <div class="agent-task">${a.current_task || 'No active task'}</div>
      ${a.branch && a.branch !== '‚Äî' ? `<div class="agent-branch">Branch: <code>${a.branch}</code></div>` : ''}
      ${a.prs && a.prs.length ? a.prs.map(pr => `<div class="agent-branch" style="margin-top:3px">PR: <code>#${pr.number}</code></div>`).join('') : ''}
    </div>`;
}

function renderPipeline(item) {
  const icon = STATUS_ICONS[item.status] || '‚è≥';
  const label = STATUS_LABELS[item.status] || item.status;
  return `
    <div class="pipe-item">
      <div class="pipe-icon">${icon}</div>
      <div class="pipe-title">
        ${item.title}
        <span class="pipe-issue">#${item.issue}</span>
      </div>
      <span class="pipe-wave">Wave ${item.wave}</span>
      <span class="pipe-status ${item.status}">${label}</span>
    </div>`;
}

function renderPR(pr, isMerged) {
  return `
    <div class="pr-item">
      <span class="pr-num">#${pr.number}</span>
      <span class="pr-title">${pr.title}</span>
      ${pr.branch ? `<span class="pr-branch"><code>${pr.branch}</code></span>` : ''}
    </div>`;
}

async function refresh() {
  try {
    const r = await fetch('/api/v1/warroom/status');
    const d = await r.json();

    document.getElementById('sys-status').textContent = d.system_status === 'operational' ? 'üü¢ Operational' : 'üî¥ Issues';
    document.getElementById('active-count').textContent = `${d.active_agents} / ${d.total_agents}`;
    document.getElementById('sprint-progress').textContent = d.sprint_progress;
    document.getElementById('progress-pct').textContent = d.sprint_percent + '%';
    document.getElementById('progress-fill').style.width = d.sprint_percent + '%';

    document.getElementById('agents-container').innerHTML = d.agents.map(renderAgent).join('');
    document.getElementById('pipeline-container').innerHTML = d.pipeline.map(renderPipeline).join('');
    document.getElementById('prs-container').innerHTML = d.open_prs.length
      ? d.open_prs.map(pr => renderPR(pr, false)).join('')
      : '<div style="text-align:center;padding:16px;color:#64748b">No open PRs ‚Äî all merged or pending</div>';
    document.getElementById('merged-container').innerHTML = d.merged_prs.length
      ? d.merged_prs.map(pr => renderPR(pr, true)).join('')
      : '<div style="text-align:center;padding:16px;color:#64748b">None yet</div>';

    const bb = document.getElementById('blocker-box');
    if (d.blockers && d.blockers.length) {
      bb.classList.add('visible');
      document.getElementById('blocker-list').innerHTML = d.blockers.map(b => `<div class="blocker-item">‚ö†Ô∏è ${b}</div>`).join('');
    } else {
      bb.classList.remove('visible');
    }

    document.getElementById('last-refresh').textContent = new Date(d.last_refresh).toLocaleString();
  } catch (e) {
    console.error('Refresh failed:', e);
  }
}

setInterval(() => {
  timer--;
  if (timer <= 0) { timer = 15; refresh(); }
  document.getElementById('refresh-text').textContent = `Auto-refresh in ${timer}s`;
}, 1000);

refresh();
</script>
</body>
</html>
